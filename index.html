<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Radar Comercial - Ponto Facial</title>
    <style>
        body { font-family: sans-serif; text-align: center; background: #f4f4f4; margin: 0; padding: 20px; }
        .container { max-width: 600px; margin: auto; background: white; padding: 20px; border-radius: 10px; shadow: 0 0 10px rgba(0,0,0,0.1); }
        video { width: 100%; border-radius: 10px; background: #000; }
        button { padding: 15px 25px; font-size: 16px; cursor: pointer; border: none; border-radius: 5px; margin: 10px; }
        .btn-ponto { background: #28a745; color: white; }
        .btn-admin { background: #6c757d; color: white; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
    </style>
</head>
<body>

<div class="container" id="tela-ponto">
    <h1>RADAR COMERCIAL</h1>
    <p>Ponto Facial Digital</p>
    <video id="video" autoplay muted></video>
    <br>
    <button class="btn-ponto" onclick="baterPonto()">Bater Ponto</button>
    <br>
    <button class="btn-admin" onclick="acessarRelatorio()">Acesso Restrito</button>
</div>

<div class="container" id="painel-relatorio" style="display:none;">
    <h2>Relatório de Batidas</h2>
    <table id="tabela-pontos">
        <thead>
            <tr>
                <th>Funcionário</th>
                <th>Data e Hora</th>
            </tr>
        </thead>
        <tbody id="corpo-tabela"></tbody>
    </table>
    <br>
    <button onclick="voltarParaPonto()">Sair do Painel</button>
</div>

<script type="module">
    // Importações do Firebase SDK v10
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getFirestore, collection, addDoc, query, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    // Sua configuração fornecida
    const firebaseConfig = {
        apiKey: "AIzaSyBRTIODyEYkXMgR5gDbEq2Q62wZ7mgReL8",
        authDomain: "radar-ponto.firebaseapp.com",
        projectId: "radar-ponto",
        storageBucket: "radar-ponto.firebasestorage.app",
        messagingSenderId: "957045066994",
        appId: "1:957045066994:web:740afa605071c69e3ed46b"
    };

    // Inicialização
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Iniciar Câmera
    const video = document.getElementById('video');
    navigator.mediaDevices.getUserMedia({ video: true })
        .then(stream => video.srcObject = stream)
        .catch(err => console.error("Erro na câmera: ", err));

    // FUNÇÃO: Bater Ponto
    window.baterPonto = async function() {
        // Exemplo: No futuro, aqui entra o nome vindo do reconhecimento facial
        const nomeFuncionario = prompt("Para teste, digite o nome do funcionário:"); 
        
        if (!nomeFuncionario) return;

        try {
            await addDoc(collection(db, "registros_ponto"), {
                nome: nomeFuncionario,
                timestamp: new Date(),
                dataHora: new Date().toLocaleString("pt-BR")
            });
            alert("Ponto de " + nomeFuncionario + " gravado na nuvem!");
        } catch (e) {
            alert("Erro ao salvar: " + e.message);
        }
    }

    // FUNÇÃO: Carregar Relatório (Firebase Realtime)
    function carregarDadosFirestore() {
        const q = query(collection(db, "registros_ponto"), orderBy("timestamp", "desc"));
        onSnapshot(q, (snapshot) => {
            const tabela = document.getElementById("corpo-tabela");
            tabela.innerHTML = "";
            snapshot.forEach((doc) => {
                const item = doc.data();
                tabela.innerHTML += `<tr><td>${item.nome}</td><td>${item.dataHora}</td></tr>`;
            });
        });
    }

    // Navegação e Senha
    window.acessarRelatorio = function() {
        const senha = prompt("Senha Administrativa:");
        if (senha === "radar2025") {
            document.getElementById("tela-ponto").style.display = "none";
            document.getElementById("painel-relatorio").style.display = "block";
            carregarDadosFirestore();
        } else {
            alert("Acesso negado.");
        }
    }

    window.voltarParaPonto = function() {
        document.getElementById("tela-ponto").style.display = "block";
        document.getElementById("painel-relatorio").style.display = "none";
    }
</script>

</body>
</html>
